# Replay Merger Docker

This project provides a Docker environment for merging replay files generated by the Wizard Research Engine (`wizeng`). It uses the `replay_gen` tool from the `wasm-r3` project to create a replay file from a WebAssembly (WASM) workload trace. **It can be used to run WASI-based benchmarks on runtimes that don't natively support WASI.**

## Usage

### 1. Generate a Trace File Using `wizeng`

First, run the Wizard Research Engine with the `r3` monitor to generate a trace file. [Install wizard](https://github.com/titzer/wizard-engine) if you don't have it installed in your system.

```bash
wizeng --monitors=r3 file.wasm
```

This command will produce a trace. Save the trace (excluding the command's output) into a file. In this example, weâ€™ll save the trace as `trace.r3`.

### 2. Clone the Repository

```bash
git clone https://github.com/r-carissimi/wasm-r3-replay-generator-docker
cd wasm-r3-replay-generator-docker
```

### 3. Build the Docker Image

Build the Docker image with the following command:

```bash
docker build . -t replay-merger
```

### 4. Run the Docker Container

To run the container, mount the necessary files as volumes:

```bash
docker run -v ./file.wasm:/app/index.wasm \
           -v ./trace.r3:/app/trace.r3 \
           -v .:/app/output \
           replay-merger
```

Ensure that:

- Your original WASM file is mounted to `/app/index.wasm`
- The generated trace file (`trace.r3`) is mounted to `/app/trace.r3`
- The output directory is mounted to `/app/output`, where the resulting `replay.wasm` file will be saved.

**Note:** The `/app/output` directory will contain the `replay.wasm` file, so ensure the mounted directory is correctly specified.

## Why Should You Do This?

You should consider this if you want to run WASI-based benchmarks on runtimes that don't natively support WASI. With Wizard, you can eliminate the WASI dependency, allowing you to run the benchmarks on environments like V8 that lack WASI support. This process generates a WASM file that doesn't rely on WASI, making it compatible with a wider range of runtimes.
